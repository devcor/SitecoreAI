@using Sitecore.Analytics;
@using Sitecore.Analytics.Model.Entities;
@using SitecoreAI.Website.Models;
@using SitecoreAI.Models;

<div>
    <h2>This is a test page to fill the contact facet AI information.</h2>
</div>
<div>
    @{
        var ran = new Random();

        var users = new List<PersonalInfo> {
            new PersonalInfo { Email = "pepito@hotmail.com", EngagementPoints = 9, FirstName = "Pepito", SurName = "Perez" },
            new PersonalInfo { Email = "juan@gmail.com", EngagementPoints = 7, FirstName = "Juan", SurName = "Castaño" },
            new PersonalInfo { Email = "pablo@gmail.com", EngagementPoints = 10, FirstName = "Pablo", SurName = "Neruda" },
            new PersonalInfo { Email = "oscar@hotmail.com", EngagementPoints = 12, FirstName = "Oscar", SurName = "Restrepo" },
            new PersonalInfo { Email = "julian@gmail.com", EngagementPoints = 8, FirstName = "Julián", SurName = "Heredia" },
            new PersonalInfo { Email = "jimmy@gmail.com", EngagementPoints = 6, FirstName = "Jimmy", SurName = "Coral" }
        };

        var labels = new List<string> { "Bot", "Competitor", "Bad client", "Good client", "IT team" };

        foreach (var user in users)
        {
            Tracker.Current.Session.Identify(user.Email);
            Tracker.Current.Interaction.Value = user.EngagementPoints;

            var contactInfo = Tracker.Current.Contact;

            var personalInfo = contactInfo.GetFacet<IContactPersonalInfo>("Personal");
            personalInfo.FirstName = user.FirstName;
            personalInfo.Surname = user.SurName;

            var aiInfo = contactInfo.GetFacet<IAIFacet>(AIFacet.FacetName);

            if (aiInfo.Training.Length == 0)
            {
                aiInfo.Training = string.Join(", ", labels);
            }

            var aiResult = aiInfo.Training.Split(',');
            var result = new List<string>();
            foreach (var line in aiResult)
            {
                result.Add(line + ":" + ran.Next(0, 100));
            }

            aiInfo.Result = string.Join("|", result);
            <div style="float: left;margin: 5px;padding: 15px;max-width: 450px;height: 160px;border: 1px solid black;">
                <p><b>@personalInfo.FirstName @personalInfo.Surname</b></p>
                <p>Contact ID: @contactInfo.ContactId.ToString()></p>
                <p>Result : @aiInfo.Result</p>
                <p>Training : @aiInfo.Training</p>
            </div>
        }

        Session.Abandon();
    }
</div>